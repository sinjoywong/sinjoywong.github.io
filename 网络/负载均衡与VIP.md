# VIP(virtual Ip address): 

vip的目的是为了高可用性

为了避免单点故障，部署多个实例提供服务

这些实例之间使用统一的协议进行存活检测（心跳）

并且定义了vip的使用优先级

在一个时间点，可能有一个实例或者多个实例在使用vip

![img](https://pic1.zhimg.com/80/v2-2e7be52e0b156d6854f3646ae9cdb783_720w.jpg?source=1940ef5c)

![img](.%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8EVIP.assets/v2-794eb47bcbe01429576867fc76bf1815_720w.jpg)

![img](.%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8EVIP.assets/v2-cb1f68319fe290612f91701585ac7dd5_720w.jpg)

> [参考]: 作者：食铁兽链
>
> []: 接：https://www.zhihu.com/question/67682565/answer/256112276
> 来源：知乎著
> []: 作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



我们在server部署了一个应用

然后需要在client去访问这个服务

Server有两个网络接口（multihomed，多归宿）

从client访问两个接口上的地址都能访问到这个应用

但是这样除了一个问题

假设平时client使用1.1.1.1访问这个应用

如果server的1.1.1.1接口出现了故障

Client怎么切换成使用2.2.2.1这个接口呢？

解决的方法就是

Client即不访问1.1.1.1，也不访问2.2.2.1

我们又在sever上配置了一个4.4.4.1的地址（开启一个loopback接口，把地址配置在这上面）

平时client访问4.4.4.1这个地址使用应用

我们在网络中配置了路由协议或者vrrp等有主备切换功能的协议

网络正常时，client走router1，使用3.3.3.3 – 3.3.3.1 -1.1.1.1 -4.4.4.1的路径访问这个应用

网络故障时，client走router2，使用3.3.3.3 – 3.3.3.2 -2.2.2.1 -4.4.4.1的路径访问这个应用

**这样，我们就规避了由于server的单个网络接口故障导致的应用中断**

这个4.4.4.1，就是一个VIP

由于这个IP不与物理接口绑定，所以这个IP不会因为物理接口的故障而实效

但是也是因为这个IP不予物理接口绑定，这个IP地址也有许多局限性，比如，server无法使用这个IP地址与邻接的router1或者router2通讯

1.1.1.1和2.2.2.1这两个地址就是physical ip address

从这个场景中就能看出

VIP是为了实现高可用性而设置的一类IP地址，**这类IP地址不与特定的实例（比如集群中的一台服务器/路由器，或者一台服务器多个网卡中的某一个网卡）绑定**，具有较高的可靠性

physical ip address是为了弥补VIP的一些局限性而存在的IP地址

————————————这是个分割线——————————————

还有两节的内容，晚些再写

## 一节是使用VIP的另一个经典例子：VRRP。

通过这个例子我们讨论一下VIP在集群中漂移

## 一节是带负载均衡器的集群

我们详细讨论一下集群中VIP漂移的仲裁机制



其实电脑上的**127.0.0.1**也是一个VIP，只是用于本机进程间的通信标识符。

如果没有127.0.0.1，那么一旦物理接口down，TCP/IP协议栈绑定在此接口上的IP就无法提供进程间的通信，所以非常不方便。

而有了127.0.0.1，不管物理接口状态如何，都可以进程间通信。

题主问题里的VIP，也是不依赖于任何物理接口，只要有一个物理接口处于工作状态（UP，可以和外部联系），就可以提供服务器的访问，当然需要通过路由发布将4.4.4.1发布出去，别的三层设备、主机需要知道如何到达4.4.4.1。

